<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gen Z</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <div class="brand">
        <button id="langBtn" class="lang-toggle" title="Language">üåê</button>
        <span id="brandSep" class="brand-sep">|</span>
        <a href="#home" class="logo">Gen Z</a>
      </div>
      <nav class="nav">
        <ul>
          <li><a id="navHome" href="#home">Home</a></li>
          <li><a id="navProducts" href="#products">Products</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" id="home">
    <h1>Welcome to Gen Z Shop</h1>
    <p>Where style meets innovation ‚Äî Express yourself, your way.</p>
    <a href="#products" class="btn">Shop Now</a>
  </section>

  <!-- Products -->
  <section class="products" id="products"><br>
    <h2 id="featuredTitle">Featured Products</h2>
    
    <div class="filters">
      <div class="filter-group">
        <label id="filterLabel" for="seasonFilter">Filter:</label>
        <select id="seasonFilter">
          <option id="optAll" value="all">All</option>
          <option id="optSummer" value="summer">Summer</option>
          <option id="optWinter" value="winter">Winter</option>
          <option id="optTop" value="top">Top</option>
          <option id="optBottom" value="bottom">Bottom</option>
        </select>
      </div>
      <div class="filter-group">
        <label id="availabilityLabel" for="stockFilter">Availability:</label>
        <select id="stockFilter">
          <option id="optStockAll" value="all">All</option>
          <option id="optIn" value="in">In stock</option>
          <option id="optOut" value="out">Out of stock</option>
        </select>
      </div>
      <div class="filter-group">
        <label id="sortPriceLabel" for="priceSort">Price:</label>
        <select id="priceSort">
          <option id="optNone" value="none">None</option>
          <option id="optLowToHigh" value="lowToHigh">Low to High</option>
          <option id="optHighToLow" value="highToLow">High to Low</option>
        </select>
      </div>
    </div><br>
    <div class="product-grid" id="productGrid"></div>
    <br><br>
  </section>


  <!-- About -->
  <section class="about">
    <div class="about-container">
      <div class="about-text">
        <h2>About Gen Z</h2>
        <p>We bring you the latest fashion trends with high-quality products. Our mission is to provide stylish clothing for everyone at affordable prices.</p>
      <br><div class="social-icons">
        <h3>Contact us</h3><br>
        <a href="https://www.facebook.com/profile.php?id=61576992284033" target="_blank">FB Page</a>
        <a href="https://www.facebook.com/groups/3533158283488475" target="_blank">FB Group</a>
        <a href="https://wa.me/+201550304882" target="_blank">WhatsApp</a>

      </div>
      </div>
      
      <div class="about-image">
        <img src="https://scontent-hbe1-1.xx.fbcdn.net/v/t39.30808-6/506248366_122104767200899742_5189433329278248353_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=MoYAEy0xs50Q7kNvwEZdEnp&_nc_oc=AdkhdZ_pCYVhjTBPcZdQSsYZSslg7aGgVOBiwKDzvnUU9pJHsQAbihSL46P-teXF838&_nc_zt=23&_nc_ht=scontent-hbe1-1.xx&_nc_gid=ywmBOpiYxHPGDHZLd8OUTg&oh=00_AfdzFWI7X5asa-Ae7dKQ3yDUOh8jl7Y2Ap1l1AZsqGnVJg&oe=690C10A9" alt="About Us">
      </div>
      
    </div>
     
  </section>
<br>
      <br>
       <br>
  <!-- Footer -->
   <br>
  <footer class="footer">
    <div class="footer-">
      <p> 2025 Gen Z Shop. All Rights Reserved.</p>
      <a href="/login" class="admin-link">Admin</a>
    </div>
  </footer>

  
  
  <script>
    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖŸÜ ÿßŸÑÿÆÿßÿØŸÖ ÿ®ÿØŸÑÿßŸã ŸÖŸÜ localStorage
    const productGrid = document.getElementById('productGrid');
    let products = [];
    fetch('/api/products', { credentials: 'include' })
      .then(r => r.json())
      .then(data => { products = Array.isArray(data) ? data : []; renderProducts(); })
      .catch(() => { products = []; renderProducts(); });

    // Admin access handled by server at /admin.html (will redirect to login)
    // Cart count
    function refreshCartCount(){
      fetch('/api/cart', { credentials: 'include' })
        .then(r => r.json())
        .then(items => {
          const cnt = Array.isArray(items) ? items.reduce((a,i)=>a + (Number(i.quantity)||1), 0) : 0;
          const el = document.getElementById('cartCount');
          if (el) el.textContent = cnt;
        })
        .catch(()=>{
          const el = document.getElementById('cartCount');
          if (el) el.textContent = 0;
        });

    }
    // Header scroll effect
    const headerEl = document.querySelector('header.header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 10) headerEl.classList.add('scrolled'); else headerEl.classList.remove('scrolled');
    });
    refreshCartCount();

    // Footer show/hide when reaching bottom
    function updateFooterVis(){
      const f = document.querySelector('footer.footer');
      if (!f) return;
      const reached = (window.scrollY + window.innerHeight) >= (document.documentElement.scrollHeight - 8);
      if (reached) f.classList.add('footer--show'); else f.classList.remove('footer--show');
    }
    updateFooterVis();
    window.addEventListener('scroll', updateFooterVis);

    // Language button remains inline next to the separator (no fixed positioning)

    // Create floating cart button (FAB)
    (function createFabCart(){
      if (document.getElementById('openCartLink')) return;
      const fab = document.createElement('button');
      fab.id = 'openCartLink';
      fab.className = 'fab-cart';
      fab.setAttribute('aria-label','Open cart');
      fab.innerHTML = 'üõí<span class="fab-badge" id="cartCount">0</span>';
      document.body.appendChild(fab);
    })();

    // ==== Cart Drawer UI ====
    // Drawer markup injected at end of body
    (function ensureCartDrawer(){
      if (document.getElementById('cartDrawer')) return;
      const wrap = document.createElement('div');
      wrap.innerHTML = `
        <div id="cartOverlay" class="cart-overlay"></div>
        <aside id="cartDrawer" class="cart-drawer">
          <div class="cart-header">
            <strong id="cartTitle">Cart</strong>
            <button id="cartClose" class="cart-close">‚úï</button>
          </div>
          <div id="cartItems" class="cart-items"></div>
          <div class="cart-footer">
            <div class="cart-total"><span id="cartTotalLabel">Total</span><strong><span id="cartTotal">0</span> EGP</strong></div>
            <button id="cartCheckout" class="btn-primary">Checkout</button>
          </div>
        </aside>
        <!-- Checkout modal (similar to product buy now) -->
        <div class="modal" id="cartCheckoutModal" style="display:none;align-items:center;justify-content:center;">
          <div class="modal-content" style="max-width:520px;width:92%;">
            <div class="cart-header" style="border:none;padding:0 0 10px 0;">
              <h3 id="ckTitle" style="margin:0">Complete Your Order</h3>
              <button id="closeCartModal" class="cart-close">‚úï</button>
            </div>
            <div class="grid">
              <input id="ckName" placeholder="Full Name" />
              <input id="ckPhone" placeholder="Phone" />
              <input id="ckGov" list="govList" placeholder="Governorate" />
              <datalist id="govList">
                <option value="Cairo ‚Äî ÿßŸÑŸÇÿßŸáÿ±ÿ©"></option>
                <option value="Giza ‚Äî ÿßŸÑÿ¨Ÿäÿ≤ÿ©"></option>
                <option value="Alexandria ‚Äî ÿßŸÑÿ•ÿ≥ŸÉŸÜÿØÿ±Ÿäÿ©"></option>
                <option value="Port Said ‚Äî ÿ®Ÿàÿ±ÿ≥ÿπŸäÿØ"></option>
                <option value="Suez ‚Äî ÿßŸÑÿ≥ŸàŸäÿ≥"></option>
                <option value="Damietta ‚Äî ÿØŸÖŸäÿßÿ∑"></option>
                <option value="Dakahlia ‚Äî ÿßŸÑÿØŸÇŸáŸÑŸäÿ©"></option>
                <option value="Sharqia ‚Äî ÿßŸÑÿ¥ÿ±ŸÇŸäÿ©"></option>
                <option value="Qalyubia ‚Äî ÿßŸÑŸÇŸÑŸäŸàÿ®Ÿäÿ©"></option>
                <option value="Kafr El Sheikh ‚Äî ŸÉŸÅÿ± ÿßŸÑÿ¥ŸäÿÆ"></option>
                <option value="Gharbia ‚Äî ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©"></option>
                <option value="Monufia ‚Äî ÿßŸÑŸÖŸÜŸàŸÅŸäÿ©"></option>
                <option value="Beheira ‚Äî ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ©"></option>
                <option value="Ismailia ‚Äî ÿßŸÑÿ•ÿ≥ŸÖÿßÿπŸäŸÑŸäÿ©"></option>
                <option value="Fayoum ‚Äî ÿßŸÑŸÅŸäŸàŸÖ"></option>
                <option value="Beni Suef ‚Äî ÿ®ŸÜŸä ÿ≥ŸàŸäŸÅ"></option>
                <option value="Minya ‚Äî ÿßŸÑŸÖŸÜŸäÿß"></option>
                <option value="Assiut ‚Äî ÿ£ÿ≥ŸäŸàÿ∑"></option>
                <option value="Sohag ‚Äî ÿ≥ŸàŸáÿßÿ¨"></option>
                <option value="Qena ‚Äî ŸÇŸÜÿß"></option>
                <option value="Luxor ‚Äî ÿßŸÑÿ£ŸÇÿµÿ±"></option>
                <option value="Aswan ‚Äî ÿ£ÿ≥ŸàÿßŸÜ"></option>
                <option value="Red Sea ‚Äî ÿßŸÑÿ®ÿ≠ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±"></option>
                <option value="New Valley ‚Äî ÿßŸÑŸàÿßÿØŸä ÿßŸÑÿ¨ÿØŸäÿØ"></option>
                <option value="Matrouh ‚Äî ŸÖÿ∑ÿ±Ÿàÿ≠"></option>
                <option value="North Sinai ‚Äî ÿ¥ŸÖÿßŸÑ ÿ≥ŸäŸÜÿßÿ°"></option>
                <option value="South Sinai ‚Äî ÿ¨ŸÜŸàÿ® ÿ≥ŸäŸÜÿßÿ°"></option>
              </datalist>
              <input id="ckCity" placeholder="City" />
              <input id="ckAddress" class="full" placeholder="Address" />
              <input id="ckAddition" class="full" placeholder="Additional info (optional)" />
              <div class="full" style="display:flex;gap:10px;align-items:center">
                <label id="ckShippingLabel">Shipping:</label>
                <span id="ckShipVal">0</span> EGP
              </div>
              <div class="full" style="text-align:right;font-weight:600"><span id="ckTotalLabel">Total</span>: <span id="ckTotal">0</span> EGP</div>
              <button id="ckConfirm" class="btn-primary">Confirm Order</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(wrap);
    })();

    // Ensure Notice modal exists
    (function ensureNoticeModal(){
      if (document.getElementById('noticeModal')) return;
      const div = document.createElement('div');
      div.innerHTML = `
        <div class="modal" id="noticeModal" style="display:none;align-items:center;justify-content:center;">
          <div class="modal-content" style="max-width:420px;width:92%;text-align:center;">
            <div id="noticeText" style="margin-bottom:12px;font-size:1rem"></div>
            <button id="noticeClose" class="btn-primary">OK</button>
          </div>
        </div>`;
      document.body.appendChild(div);
      document.getElementById('noticeClose').addEventListener('click', ()=>{
        document.getElementById('noticeModal').style.display = 'none';
      });
      window.addEventListener('click', (e)=>{ const m = document.getElementById('noticeModal'); if (e.target === m) m.style.display='none'; });
    })();

    const openCartLink = document.getElementById('openCartLink');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartOverlay = document.getElementById('cartOverlay');
    const cartItems = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');
    const cartClose = document.getElementById('cartClose');
    const cartCheckoutBtn = document.getElementById('cartCheckout');
    const cartCheckoutModal = document.getElementById('cartCheckoutModal');
    const closeCartModalBtn = document.getElementById('closeCartModal');
    const ckTotal = document.getElementById('ckTotal');

    function openCart(){
      cartOverlay.style.display = 'block';
      cartDrawer.style.right = '0';
      const fab = document.getElementById('openCartLink'); if (fab) fab.style.display = 'none';
      loadCartDrawer();
    }
    function closeCart(){
      cartOverlay.style.display = 'none';
      cartDrawer.style.right = '-420px';
      const fab = document.getElementById('openCartLink'); if (fab) fab.style.display = 'flex';
    }
    openCartLink.addEventListener('click', (e)=>{ e.preventDefault(); openCart(); });
    cartOverlay.addEventListener('click', closeCart);
    cartClose.addEventListener('click', closeCart);

    function renderCartDrawer(items){
      if (!Array.isArray(items) || items.length === 0){
        cartItems.innerHTML = '<div style="padding:16px;text-align:center;color:#666" id="cartEmptyMsg">Your cart is empty.</div>';
        cartTotalEl.textContent = '0';
        ckTotal.textContent = '0';
        return;
      }
      let html = '';
      let subtotal = 0;
      items.forEach(it => {
        const price = Number(it.price) || 0;
        const qty = Number(it.quantity) || 1;
        subtotal += price * qty;
        html += `
          <div class="cart-row">
            <img src="${it.image || ''}" alt=""/>
            <div class="cart-info">
              <div class="name">${it.name}</div>
              <div class="meta">
                <span class="color-dot" style="background:${it.color || '#ccc'}"></span>
                ${it.size ? '<span style="margin-inline-start:6px">'+it.size+'</span>' : ''}
              </div>
              <div class="price">${price.toFixed(2)} EGP</div>
            </div>
            <div class="qty">
              <button data-act="dec" data-id="${it.id}">-</button>
              <span>${qty}</span>
              <button data-act="inc" data-id="${it.id}">+</button>
            </div>
          </div>
        `;
      });
      cartItems.innerHTML = html;
      cartTotalEl.textContent = subtotal.toFixed(2);
      // Compute shipping from governorate similar to product page
      function computeShip(){
        const raw = (document.getElementById('ckGov')?.value || '').trim();
        if (!raw) return 0;
        // normalize: allow "English ‚Äî ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" or pure Arabic/English
        const gov = raw.split('‚Äî')[0].trim() || raw;
        const upperEn = ["Minya","Assiut","Sohag","Qena","Luxor","Aswan"];
        const upperAr = ["ÿßŸÑŸÖŸÜŸäÿß","ÿ£ÿ≥ŸäŸàÿ∑","ÿ≥ŸàŸáÿßÿ¨","ŸÇŸÜÿß","ÿßŸÑÿ£ŸÇÿµÿ±","ÿ£ÿ≥ŸàÿßŸÜ"];
        return (upperEn.includes(gov) || upperAr.includes(raw.split('‚Äî')[1]?.trim() || raw)) ? 90 : 70;
      }
      const ship = computeShip();
      const sv = document.getElementById('ckShipVal'); if (sv) sv.textContent = String(ship);
      ckTotal.textContent = (subtotal + ship).toFixed(2);

      cartItems.querySelectorAll('button[data-id]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const act = btn.getAttribute('data-act');
          const row = items.find(x => String(x.id) === String(id));
          if (!row) return;
          let newQty = Number(row.quantity)||1;
          newQty = act === 'inc' ? newQty + 1 : newQty - 1;
          if (newQty <= 0){
            fetch('/api/cart/' + encodeURIComponent(id), { method:'DELETE', credentials:'include' })
              .then(()=>{ loadCartDrawer(); refreshCartCount(); })
              .catch(()=>{});
          } else {
            fetch('/api/cart/' + encodeURIComponent(id), { method:'PATCH', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ quantity: newQty }) })
              .then(()=>{ loadCartDrawer(); refreshCartCount(); })
              .catch(()=>{});
          }
        });
      });
    }

    function loadCartDrawer(){
      fetch('/api/cart', { credentials: 'include' })
        .then(r => r.json())
        .then(items => renderCartDrawer(Array.isArray(items)?items:[]))
        .catch(()=> renderCartDrawer([]));
    }

    const ckGovEl = document.getElementById('ckGov');
    ckGovEl.addEventListener('change', ()=>{
      fetch('/api/cart', { credentials: 'include' })
        .then(r=>r.json()).then(items=>{
          const subtotal = (Array.isArray(items)?items:[]).reduce((s,it)=> s + (Number(it.price)||0)*(Number(it.quantity)||1), 0);
          const upperEn = ["Minya","Assiut","Sohag","Qena","Luxor","Aswan"];
          const upperAr = ["ÿßŸÑŸÖŸÜŸäÿß","ÿ£ÿ≥ŸäŸàÿ∑","ÿ≥ŸàŸáÿßÿ¨","ŸÇŸÜÿß","ÿßŸÑÿ£ŸÇÿµÿ±","ÿ£ÿ≥ŸàÿßŸÜ"];
          const raw = (ckGovEl.value||'').trim();
          const left = raw.split('‚Äî')[0].trim(); const right = (raw.split('‚Äî')[1]||'').trim();
          const ship = raw ? ((upperEn.includes(left) || upperAr.includes(right||raw)) ? 70 : 50) : 0;
          const sv = document.getElementById('ckShipVal'); if (sv) sv.textContent = String(ship);
          ckTotal.textContent = (subtotal + ship).toFixed(2);
        });
    });

    cartCheckoutBtn.addEventListener('click', ()=>{
      cartCheckoutModal.style.display = 'flex';
    });
    closeCartModalBtn.addEventListener('click', ()=>{ cartCheckoutModal.style.display = 'none'; });
    window.addEventListener('click', (e)=>{ if (e.target === cartCheckoutModal) cartCheckoutModal.style.display = 'none'; });

    document.getElementById('ckConfirm').addEventListener('click', async ()=>{
      const name = document.getElementById('ckName').value.trim();
      const phone = document.getElementById('ckPhone').value.trim();
      const gov = document.getElementById('ckGov').value.trim();
      const city = document.getElementById('ckCity').value.trim();
      const address = document.getElementById('ckAddress').value.trim();
      const addition = document.getElementById('ckAddition').value.trim();
      const govVal = (document.getElementById('ckGov').value||'').trim();
      const upper = ["Minya","Assiut","Sohag","Qena","Luxor","Aswan"];
      const shipping = govVal ? (upper.includes(govVal) ? 70 : 50) : 0;
      if (!name || !phone || !gov || !city || !address){ showNotice('fill_required', 'Please fill all required fields.'); return; }
      try {
        const res = await fetch('/api/orders/checkout', { method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ name, phone, gov, city, address, addition, shipping }) });
        const data = await res.json();
        if (!res.ok){ showNotice('checkout_failed', data.error||'Checkout failed'); return; }
        cartCheckoutModal.style.display = 'none';
        closeCart();
        refreshCartCount();
        showNotice('order_success', 'Order placed successfully!');
      } catch(e){ alert('Checkout failed'); }
    });
    const seasonFilter = document.getElementById('seasonFilter');
    const stockFilter = document.getElementById('stockFilter');
    const priceSort = document.getElementById('priceSort');function renderProducts() {
      productGrid.innerHTML = '';

      let filteredProducts = [...products];

      // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖŸàÿ≥ŸÖ/ÿßŸÑŸÜŸàÿπ
      const season = seasonFilter.value;
      if (season !== 'all') {
        filteredProducts = filteredProducts.filter(p => p.season === season || p.type === season);
      }

  // ŸÅŸÑÿ™ÿ± ÿßŸÑŸÖÿÆÿ≤ŸàŸÜ
  const stock = stockFilter.value; // ŸÇŸäŸÖÿ™Ÿá: 'all' ÿ£Ÿà 'in' ÿ£Ÿà 'out'
  if (stock !== 'all') {
    filteredProducts = filteredProducts.filter(p => p.status === stock);
  }

  // ŸÅÿ±ÿ≤ ÿßŸÑÿ≥ÿπÿ±
  const sort = priceSort.value;
  if (sort === 'lowToHigh') filteredProducts.sort((a,b) => a.price - b.price);
  else if (sort === 'highToLow') filteredProducts.sort((a,b) => b.price - a.price);

  // Animation container (optional) ‚Äî ŸÑŸà ÿπŸÜÿØŸÉ container ÿ™ÿ±ŸäÿØ ÿ™ÿ∂ŸäŸÅ ŸÑŸá fade class
  // const containerEl = document.querySelector('.product-grid');
  // containerEl.classList.add('fade-out');
  // setTimeout(() => { containerEl.classList.remove('fade-out'); containerEl.classList.add('fade-in'); }, 50);

  // helper to pick primary image
  function getPrimaryImage(p){
    try{
      if (Array.isArray(p.images) && p.images.length) return p.images[0];
      if (typeof p.image === 'string'){
        if (p.image.includes(',')) return p.image.split(',')[0].trim();
        if (p.image.trim()) return p.image.trim();
      }
    }catch(e){}
    return 'https://via.placeholder.com/600x400';
  }

  filteredProducts.forEach((p) => {
  const card = document.createElement('div');
  card.className = 'product-card';
  card.style.opacity = 0;
  card.style.transition = 'opacity 0.5s ease';

  // ŸÑŸà ÿßŸÑŸÖŸÜÿ™ÿ¨ Out of Stock
  const isOut = p.status === 'out';

  const colors = (p.color||'').split(',').map(c=>c.trim()).filter(Boolean);
  const primaryImg = getPrimaryImage(p);
  card.innerHTML = `
    <div class="product-image-container ${isOut ? 'out-stock' : ''}" data-id="${p.id}">
      <img src="${primaryImg}" alt="${p.name}">
      ${isOut ? `<span class="out-label">${t('out')}</span>` : ''}
    </div>
    <h3>${p.name}</h3>
    <div class="card-footer">
      <p class="price">${p.price} EGP</p>
      <div class="color-list">
        ${colors.map((c,i)=>`<span class="color-dot" data-color="${c}" ${i===0?'data-selected="1"':''} style="background:${c}"></span>`).join('')}
      </div>
    </div>
    <div class="card-actions">
      <button class="btn-secondary" data-act="details" data-id="${p.id}" ${isOut ? 'disabled' : ''}>${t('view_details')}</button>
      <button class="btn-secondary" data-act="add" data-id="${p.id}" ${isOut ? 'disabled' : ''}>${t('add_to_cart')}</button>
    </div>
  `;

  if (isOut) { card.classList.add('is-out'); }
  productGrid.appendChild(card);

  setTimeout(() => { card.style.opacity = 1; }, 100);
  // Image or card click navigates
  card.querySelector('.product-image-container').addEventListener('click', (e)=>{
    e.preventDefault(); if (isOut) return; window.location.href = 'product.html?id=' + encodeURIComponent(p.id);
  });
  // Hover swap to model image if available
  (function(){
    const imgWrap = card.querySelector('.product-image-container');
    const img = imgWrap && imgWrap.querySelector('img');
    const modelUrl = (p && p.model_image && String(p.model_image).trim()) || '';
    if (!img || !modelUrl) return;
    // Preload model image for smooth hover
    const pre = new Image(); pre.src = modelUrl;
    const original = img.getAttribute('src');
    imgWrap.addEventListener('mouseenter', ()=>{ img.setAttribute('src', modelUrl); });
    imgWrap.addEventListener('mouseleave', ()=>{ img.setAttribute('src', original); });
  })();
  // Color selection
  card.querySelectorAll('.color-dot').forEach(dot=>{
    dot.addEventListener('click', (e)=>{
      e.stopPropagation();
      card.querySelectorAll('.color-dot').forEach(d=>d.classList.remove('is-selected'));
      dot.classList.add('is-selected');
      card.setAttribute('data-color', dot.getAttribute('data-color'));
    });
  });
});

// ÿ™ŸÅÿπŸäŸÑ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
document.querySelectorAll('button[data-act="details"]').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.preventDefault();
    const id = btn.getAttribute('data-id');
    if (!id) return;
    window.location.href = 'product.html?id=' + encodeURIComponent(id);
  });
});
// Add to cart from card
document.querySelectorAll('button[data-act="add"]').forEach(btn=>{
  btn.addEventListener('click', async (e)=>{
    e.preventDefault();
    const id = btn.getAttribute('data-id');
    const card = btn.closest('.product-card');
    const color = card.getAttribute('data-color') || (card.querySelector('.color-dot')?.getAttribute('data-color')) || '';
    if (!color){ showNotice && showNotice('fill_color','Please select a color first.'); return; }
    const pid = id;
    // fetch product sizes for default size
    try{
      const pr = await fetch('/api/products/'+encodeURIComponent(pid), {credentials:'include'});
      const pdata = await pr.json();
      const sizes = (pdata.sizes||'').split(',').map(s=>s.trim()).filter(Boolean);
      const size = sizes[0] || 'L';
      await fetch('/api/cart', {method:'POST', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify({ product_id: pid, size, color, quantity: 1 })});
      refreshCartCount && refreshCartCount();
      showNotice && showNotice('added_to_cart','Added to cart!');
    }catch(err){ showNotice && showNotice('add_failed','Failed to add to cart'); }
  });
});

  // ÿ±ÿ®ÿ∑ ÿ£ÿ≤ÿ±ÿßÿ± View Details ŸÑŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÅŸÇÿ∑
  document.querySelectorAll('.product-card').forEach((card) => {
    const btn = card.querySelector('button[data-act="details"]');
    if (!btn) return;
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      if (btn.disabled) return;
      const id = btn.getAttribute('data-id');
      if (!id) return;
      window.location.href = 'product.html?id=' + encodeURIComponent(id);
    });
  });
}

// ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÖŸÜ ÿ¨ÿØŸäÿØ
// ÿßŸÑÿ™ŸÅÿπŸäŸÑ
seasonFilter.addEventListener('change', renderProducts);
stockFilter.addEventListener('change', renderProducts);
priceSort.addEventListener('change', renderProducts);

// ÿ£ŸàŸÑ ÿπÿ±ÿ∂ ÿ≥Ÿäÿ™ŸÖ ÿ®ÿπÿØ ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿÆÿßÿØŸÖ

// ====== I18N (external lang.json) ======
let I18N = null;
async function loadLangs(){
  if (I18N) return I18N;
  try { const r = await fetch('lang.json', {cache:'no-cache'}); I18N = await r.json(); } catch(e){ I18N = null; }
  return I18N;
}
function getLang(){ return localStorage.getItem('lang') || 'en'; }
function t(k){ const l=getLang(); const F = (I18N && I18N[l]) || (I18N && I18N.en) || {}; return F[k] || k; }
async function applyTranslations(){
  await loadLangs();
  const l = getLang();
  document.documentElement.dir = 'ltr';
  // Header layout
  const hc = document.querySelector('.header-container');
  const brand = document.querySelector('.brand');
  const nav = document.querySelector('.nav');
  const lbBtn = document.getElementById('langBtn');
  const logo = document.querySelector('.logo');
  if (hc){ hc.style.display='flex'; hc.style.alignItems='center'; hc.style.gap='16px'; }
  if (brand){ brand.style.display='flex'; brand.style.alignItems='center'; brand.style.gap='12px'; }
  // Keep static layout: brand left, nav right (no reordering per language)
  if (brand){ brand.style.order = '1'; brand.style.marginInlineStart = '0'; }
  if (nav){ nav.style.order = '2'; nav.style.marginInlineStart = 'auto'; }
  const sep = document.getElementById('brandSep');
  if (lbBtn && logo && sep){ lbBtn.style.order = '0'; sep.style.order = '1'; logo.style.order = '2'; }
  const set = (id, txt)=>{ const el=document.getElementById(id); if (el) el.textContent = txt; };
  set('navHome', t('home'));
  set('navProducts', t('products'));
  set('featuredTitle', t('featured'));
  const ht = document.querySelector('#home h1'); if (ht) ht.textContent = t('hero_title');
  const hs = document.querySelector('#home p'); if (hs) hs.textContent = t('hero_sub');
  const sb = document.querySelector('#home .btn'); if (sb) sb.textContent = t('shop_now');
  set('cartTitle', t('cart'));
  set('cartTotalLabel', t('total'));
  const co = document.getElementById('cartCheckout'); if (co) co.textContent = t('checkout');
  set('ckTitle', t('ck_title'));
  const ph = (id, key)=>{ const el=document.getElementById(id); if (el) el.setAttribute('placeholder', t(key)); };
  ph('ckName','name'); ph('ckPhone','phone'); ph('ckGov','gov'); ph('ckCity','city'); ph('ckAddress','address'); ph('ckAddition','addn');
  set('ckShippingLabel', t('shipping'));
  set('ckTotalLabel', t('total'));
  const cf = document.getElementById('ckConfirm'); if (cf) cf.textContent = t('confirm');
  const cem = document.getElementById('cartEmptyMsg'); if (cem) cem.textContent = t('cart_empty');
  const lb = document.getElementById('langBtn'); if (lb) lb.textContent = 'üåê';

  // Filters & options
  set('filterLabel', t('filter'));
  set('availabilityLabel', t('availability'));
  set('sortPriceLabel', t('sort_price'));
  set('optAll', t('all'));
  set('optSummer', t('summer'));
  set('optWinter', t('winter'));
  set('optTop', t('top'));
  set('optBottom', t('bottom'));
  set('optStockAll', t('all'));
  set('optIn', t('in'));
  set('optOut', t('out'));
  set('optNone', t('none'));
  set('optLowToHigh', t('lowToHigh'));
  set('optHighToLow', t('highToLow'));

  // Re-render products to update button labels, badges, etc.
  try { if (typeof renderProducts === 'function') renderProducts(); } catch(e){}
}
function setLang(l){ localStorage.setItem('lang', l); applyTranslations(); }
const langBtn = document.getElementById('langBtn');
// Build a small select menu on demand
(function setupLangMenu(){
  if (!langBtn) return;
  let menu = document.getElementById('langMenu');
  if (!menu){
    menu = document.createElement('div');
    menu.id = 'langMenu';
    menu.style.cssText = 'position:fixed;display:none;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:8px;box-shadow:0 10px 25px rgba(0,0,0,.12);z-index:1000;';
    menu.innerHTML = '<select id="langSelect" style="padding:6px 8px;border-radius:6px;border:1px solid #e5e7eb"><option value="en">English</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option></select>';
    document.body.appendChild(menu);
  }
  function place(){
    const r = langBtn.getBoundingClientRect();
    menu.style.left = r.left + 'px';
    menu.style.top = (r.bottom + 8) + 'px';
  }
  langBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    place();
    const sel = document.getElementById('langSelect'); if (sel) sel.value = getLang();
    menu.style.display = (menu.style.display==='none' || !menu.style.display) ? 'block' : 'none';
  });
  document.addEventListener('click', (e)=>{
    if (e.target === langBtn || menu.contains(e.target)) return;
    menu.style.display = 'none';
  });
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape') menu.style.display='none'; });
  document.body.addEventListener('change', (e)=>{
    if (e.target && e.target.id === 'langSelect'){ setLang(e.target.value); menu.style.display='none'; }
  });
})();
applyTranslations();

// Custom notice
function showNotice(key, fallback){
  const modal = document.getElementById('noticeModal');
  const txt = document.getElementById('noticeText');
  if (!modal || !txt) return alert(fallback || key);
  txt.textContent = t(key) || fallback || '';
  modal.style.display = 'flex';
}

  </script>
  </body>
  </html>
